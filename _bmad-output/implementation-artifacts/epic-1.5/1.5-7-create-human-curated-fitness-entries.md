# Story 1.5-7: Create Human-Curated Fitness Entries

Status: done

## Story

As a **Swealog developer**,
I want **human-written fitness entries beyond CSV-derived data**,
So that **Parser handles natural human writing styles not captured in structured export**.

## Acceptance Criteria

1. **Directory created** - `tests/corpus/fitness/entries/human/` directory exists

2. **Expected output directory created** - `tests/corpus/fitness/expected/parser/human/` directory exists

3. **Entries written naturally** - Entries are NOT derived from CSV structure; they represent genuine freeform human writing

4. **Stream-of-consciousness style** - At least 5 entries use rambling, unstructured narrative style (thoughts, digressions, incomplete sentences)

5. **Very casual style** - At least 5 entries use extremely informal language (slang, abbreviations, emoji-like expressions, missing punctuation)

6. **Highly detailed style** - At least 5 entries include extensive context beyond workout data (feelings, environment, interruptions, social context)

7. **Context that CSV lacks** - Entries include: feelings/mood, environmental factors, interruptions, equipment issues, social interactions, gym conditions

8. **Human-validated expected output** - Each entry has corresponding expected JSON using `ExpectedParserOutput` schema (from `tests/corpus/schemas/expected_output.py`)

9. **Minimum 15 entries** - At least 15 human-curated fitness entries are created (per epics.md)

10. **Validation test** - pytest test at `tests/corpus/test_human_entries.py` validates:
    - Entry count >= 15
    - Category distribution (stream >= 5, casual >= 5, detailed >= 5)
    - All entries have expected outputs
    - All expected outputs parse against `ExpectedParserOutput` schema
    - No orphan expected outputs (all expected have matching entries)
    - All entries are readable as UTF-8

## Tasks / Subtasks

- [x] Task 1: Create directory structure (AC: #1, #2)
  - [x] 1.1 Create `tests/corpus/fitness/entries/human/` directory
  - [x] 1.2 Create `tests/corpus/fitness/expected/parser/human/` directory

- [x] Task 2: Create stream-of-consciousness entries (AC: #3, #4, #7)
  - [x] 2.1 Create `human-stream-001.md` - Korean, rambling chest day with digressions
  - [x] 2.2 Create `human-stream-002.md` - English, unfocused back workout with tangents
  - [x] 2.3 Create `human-stream-003.md` - Mixed language, interrupted leg day narrative
  - [x] 2.4 Create `human-stream-004.md` - Korean, confused about weights/sets
  - [x] 2.5 Create `human-stream-005.md` - English, multiple false starts

- [x] Task 3: Create very casual entries (AC: #3, #5, #7)
  - [x] 3.1 Create `human-casual-001.md` - Minimal punctuation, heavy abbreviations
  - [x] 3.2 Create `human-casual-002.md` - Slang-heavy, incomplete thoughts
  - [x] 3.3 Create `human-casual-003.md` - Korean text-speak style
  - [x] 3.4 Create `human-casual-004.md` - Emoji-like expressions (ㅋㅋㅋ, lol)
  - [x] 3.5 Create `human-casual-005.md` - Ultra-short fragments

- [x] Task 4: Create highly detailed entries (AC: #3, #6, #7)
  - [x] 4.1 Create `human-detailed-001.md` - Full context: mood, weather, gym crowding
  - [x] 4.2 Create `human-detailed-002.md` - Equipment issues, interrupted workout
  - [x] 4.3 Create `human-detailed-003.md` - Social interaction affecting workout
  - [x] 4.4 Create `human-detailed-004.md` - Post-injury careful workout narrative
  - [x] 4.5 Create `human-detailed-005.md` - Time constraints affecting exercise selection

- [x] Task 5: Create expected parser outputs (AC: #8)
  - [x] 5.1 Create expected JSON for stream entries (5 files) using `ExpectedParserOutput` schema
  - [x] 5.2 Create expected JSON for casual entries (5 files) using `ExpectedParserOutput` schema
  - [x] 5.3 Create expected JSON for detailed entries (5 files) using `ExpectedParserOutput` schema

- [x] Task 6: Create validation test (AC: #9, #10)
  - [x] 6.1 Create `tests/corpus/test_human_entries.py` following existing test patterns
  - [x] 6.2 Import `ExpectedParserOutput` from `tests/corpus/schemas`
  - [x] 6.3 Add tests: entry count, category distribution, expected output coverage
  - [x] 6.4 Add tests: schema validation, orphan check, UTF-8 readability
  - [x] 6.5 Run `uv run ruff check . && uv run pyright && uv run pytest tests/corpus/test_human_entries.py -v`

## Dev Notes

### Entry File Format

Human entries use the same YAML frontmatter as synthetic entries but with different metadata:

```yaml
---
category: stream | casual | detailed
difficulty: medium | hard
notes: "Brief description of writing style characteristics"
validated_by: human
---
[Entry content - natural freeform text]
```

### Examples from Epics.md

The epics.md provides two key examples of the target writing style:

**Stream-of-consciousness (English transition to machines):**
```
Started with bench but shoulder felt off so switched to machines. Did some chest flies 15kg each hand, maybe 4 sets? Lost count. Finished with stretching.
```

**Very casual Korean:**
```
오늘 컨디션 별로였는데 그래도 데드 쳤음. 140으로 시작해서 160까지 올렸다가 마지막에 힘빠져서 140으로 마무리. 총 6세트인가 7세트 한 듯
```

### Key Differences from Synthetic Entries

| Aspect | Synthetic (from_csv, synthetic/) | Human (human/) |
|--------|----------------------------------|----------------|
| Origin | Derived from structured CSV export | Written naturally by human |
| Structure | Clear exercise/weight/reps patterns | Messy, incomplete, rambling |
| Context | Exercise data only | Feelings, environment, interruptions |
| Numbers | Precise (100kg x 5 reps) | Approximate ("maybe 4 sets?", "6 or 7") |
| Language | Consistent | Mixed register, code-switching |
| Completeness | Full workout data | Partial, forgotten details |

### Context Elements to Include (AC #6)

**Feelings/Mood:**
- Pre-workout state (tired, energized, stressed)
- Mid-workout feelings (pumped, struggling, bored)
- Post-workout assessment (satisfied, frustrated, accomplished)

**Environmental Factors:**
- Gym crowding affecting equipment access
- Weather impact on motivation
- Time of day considerations

**Interruptions:**
- Phone calls/texts mid-workout
- Conversations with gym buddies
- Equipment unavailability wait times

**Equipment Issues:**
- Machine out of order
- Weight plates missing
- Bench occupied

**Social Interactions:**
- Workout partners affecting sets/reps
- Spotting others
- Training tips received

### Expected Output Schema

Use `ExpectedParserOutput` schema from `tests/corpus/schemas/expected_output.py` (NOT the application schema).

```python
# From tests/corpus/schemas/expected_output.py
class ExpectedParserOutput(BaseModel):
    activity_type: str = "workout"
    exercises: list[ExpectedExerciseRecord]
    date: str  # Use "human" for human-curated entries

class ExpectedExerciseRecord(BaseModel):
    name: str
    sets: int
    set_details: list[ExpectedSetDetail] = []
    weight_unit: str = "kg"

class ExpectedSetDetail(BaseModel):
    set_num: int
    weight: float | None = None
    reps: int | None = None
```

**IMPORTANT:** Use `date: "human"` for all human-curated entries (similar to `date: "synthetic"` for synthetic entries).

Expected outputs should reflect **best effort parsing** - the Parser must extract what it can even from messy input. For ambiguous data:
- Approximate numbers: Use the mentioned value (e.g., "maybe 4 sets" → 4 sets)
- Unclear exercises: Use the most likely interpretation
- Missing data: Use `null` in JSON

### Validation Test Structure

```python
# tests/corpus/test_human_entries.py
"""Tests for human-curated fitness corpus entries.

Validates the structure and integrity of human-written fitness test entries
that test Parser handling of natural human writing styles.
"""

from pathlib import Path

import pytest

from tests.corpus.schemas import ExpectedParserOutput

HUMAN_ENTRIES_DIR = Path(__file__).parent / "fitness" / "entries" / "human"
HUMAN_EXPECTED_DIR = Path(__file__).parent / "fitness" / "expected" / "parser" / "human"


class TestHumanEntriesCorpusIntegrity:
    """Verify human entry corpus structure and content."""

    def test_minimum_entry_count(self) -> None:
        """Ensure at least 15 human entries exist (AC #9)."""
        entries = list(HUMAN_ENTRIES_DIR.glob("human-*.md"))
        assert len(entries) >= 15, f"Expected >= 15 entries, found {len(entries)}"

    def test_directories_exist(self) -> None:
        """Verify entry and expected directories exist (AC #1, #2)."""
        assert HUMAN_ENTRIES_DIR.exists(), "Human entries directory does not exist"
        assert HUMAN_ENTRIES_DIR.is_dir(), "Human entries path is not a directory"
        assert HUMAN_EXPECTED_DIR.exists(), "Human expected directory does not exist"
        assert HUMAN_EXPECTED_DIR.is_dir(), "Human expected path is not a directory"

    @pytest.mark.parametrize(
        ("category", "min_count"),
        [
            ("stream", 5),
            ("casual", 5),
            ("detailed", 5),
        ],
    )
    def test_category_coverage(self, category: str, min_count: int) -> None:
        """Verify each category has minimum required entries (AC #4, #5, #6)."""
        entries = list(HUMAN_ENTRIES_DIR.glob(f"human-{category}-*.md"))
        assert len(entries) >= min_count, f"Expected >= {min_count} {category} entries, found {len(entries)}"

    def test_all_entries_have_expected_outputs(self) -> None:
        """Verify every entry has a matching expected output (AC #8)."""
        entries = list(HUMAN_ENTRIES_DIR.glob("human-*.md"))
        for entry in entries:
            expected_path = HUMAN_EXPECTED_DIR / f"{entry.stem}.json"
            assert expected_path.exists(), f"Missing expected output for {entry.name}"

    def test_expected_outputs_are_valid(self) -> None:
        """Verify all expected outputs match ExpectedParserOutput schema (AC #8)."""
        expected_files = list(HUMAN_EXPECTED_DIR.glob("*.json"))
        for expected_file in expected_files:
            output = ExpectedParserOutput.model_validate_json(
                expected_file.read_text(encoding="utf-8")
            )
            assert output.date == "human", f"{expected_file.name}: date should be 'human'"

    def test_no_orphan_expected_outputs(self) -> None:
        """Verify all expected outputs have matching entries."""
        expected_files = list(HUMAN_EXPECTED_DIR.glob("*.json"))
        for expected_file in expected_files:
            entry_path = HUMAN_ENTRIES_DIR / f"{expected_file.stem}.md"
            assert entry_path.exists(), f"Orphan expected output: {expected_file.name} has no entry"

    def test_entries_are_readable(self) -> None:
        """Verify all entries can be read as UTF-8."""
        entries = list(HUMAN_ENTRIES_DIR.glob("human-*.md"))
        for entry in entries:
            try:
                _ = entry.read_text(encoding="utf-8")
            except UnicodeDecodeError as e:
                pytest.fail(f"Entry {entry.name} is not valid UTF-8: {e}")
```

### Example Expected JSON Output

For entry like: "벤치 80으로 시작해서 100까지 올림. 3세트씩 5개"

```json
{
  "activity_type": "workout",
  "exercises": [
    {
      "name": "Bench Press (Barbell)",
      "sets": 3,
      "weight_unit": "kg",
      "set_details": [
        {"set_num": 1, "weight": 80.0, "reps": 5},
        {"set_num": 2, "weight": 90.0, "reps": 5},
        {"set_num": 3, "weight": 100.0, "reps": 5}
      ]
    }
  ],
  "date": "human"
}
```

Note: When set-by-set breakdown is unclear from messy human input, use best-effort interpretation. If weights/reps per set are not clear, you may use averaged values or mark reps as `null`.

### Project Structure Notes

- This is **Swealog application** test data (fitness-specific)
- Location: `tests/corpus/fitness/entries/human/` (per directory structure in project-context.md)
- Expected outputs: `tests/corpus/fitness/expected/parser/human/`
- Tests: `tests/corpus/test_human_entries.py`

### Previous Story Patterns (1.5-6 Learnings)

From Story 1.5-6 completion:
- Use `ConfigDict(strict=True)` for Pydantic models
- Google-style docstrings with Attributes section
- Validation tests check: file existence, schema parsing, minimum counts
- Clear error messages for debugging
- Run full validation: `uv run ruff check . && uv run pyright && uv run pytest tests/corpus/test_human_entries.py -v`

### Writing Style Guidelines

**Stream-of-consciousness:** Write as if talking to yourself, include digressions, false starts, corrections mid-sentence, forgotten details mentioned later.

**Very casual:** Heavy abbreviations (벤치→벤, kg→키로), missing punctuation, slang, incomplete sentences, text-message style.

**Highly detailed:** Include pre-workout context, mid-workout observations, post-workout reflection, environmental factors, social interactions.

### Naming Convention

Files follow pattern: `human-{category}-{NNN}.md`
- `human-stream-001.md` through `human-stream-005.md`
- `human-casual-001.md` through `human-casual-005.md`
- `human-detailed-001.md` through `human-detailed-005.md`

### References

- [Source: _bmad-output/planning-artifacts/epics.md#Story 1.5-7] - Full acceptance criteria and examples
- [Source: tests/corpus/fitness/entries/synthetic/] - Synthetic entry format patterns
- [Source: tests/corpus/schemas/expected_output.py] - ExpectedParserOutput schema (use this for expected JSONs)
- [Source: tests/corpus/test_edge_cases.py] - Reference test structure pattern to follow
- [Source: tests/corpus/test_multilingual.py] - Another reference test pattern
- [Source: _bmad-output/implementation-artifacts/epic-1.5/1.5-6-create-query-flow-expected-outputs.md] - Previous story patterns

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

- All tests pass: `uv run pytest tests/corpus/test_human_entries.py -v` (9 passed)
- Full test suite: 267 passed, 3 skipped

### Completion Notes List

1. Created 15 human-curated fitness entries across 3 categories:
   - 5 stream-of-consciousness entries with rambling, unstructured narratives
   - 5 very casual entries with slang, abbreviations, emoji-like expressions
   - 5 highly detailed entries with full context (mood, weather, social interactions)

2. Each entry includes context not found in CSV exports:
   - Feelings/mood (tired, energized, frustrated)
   - Environmental factors (gym crowding, weather, equipment issues)
   - Social interactions (workout partners, spotting)
   - Interruptions (phone calls, equipment unavailability)

3. Expected outputs use `date: "human"` marker for identification

4. Validation test covers all AC requirements:
   - Directory existence
   - Entry count >= 15
   - Category distribution (5+ per category)
   - Expected output coverage
   - Schema validation
   - Orphan check
   - UTF-8 readability

### File List

**Created:**
- `tests/corpus/fitness/entries/human/human-stream-001.md` - Korean rambling chest day
- `tests/corpus/fitness/entries/human/human-stream-002.md` - English back workout with tangents
- `tests/corpus/fitness/entries/human/human-stream-003.md` - Mixed language leg day
- `tests/corpus/fitness/entries/human/human-stream-004.md` - Korean confused shoulder workout
- `tests/corpus/fitness/entries/human/human-stream-005.md` - English arms with false starts
- `tests/corpus/fitness/entries/human/human-casual-001.md` - Minimal punctuation chest
- `tests/corpus/fitness/entries/human/human-casual-002.md` - Slang-heavy back day
- `tests/corpus/fitness/entries/human/human-casual-003.md` - Korean text-speak deadlift
- `tests/corpus/fitness/entries/human/human-casual-004.md` - Emoji expressions leg day
- `tests/corpus/fitness/entries/human/human-casual-005.md` - Ultra-short shoulder fragments
- `tests/corpus/fitness/entries/human/human-detailed-001.md` - Full context chest workout
- `tests/corpus/fitness/entries/human/human-detailed-002.md` - Equipment issues back day
- `tests/corpus/fitness/entries/human/human-detailed-003.md` - Social interaction leg day
- `tests/corpus/fitness/entries/human/human-detailed-004.md` - Post-injury back workout
- `tests/corpus/fitness/entries/human/human-detailed-005.md` - Time-constrained shoulder
- `tests/corpus/fitness/expected/parser/human/human-stream-001.json`
- `tests/corpus/fitness/expected/parser/human/human-stream-002.json`
- `tests/corpus/fitness/expected/parser/human/human-stream-003.json`
- `tests/corpus/fitness/expected/parser/human/human-stream-004.json`
- `tests/corpus/fitness/expected/parser/human/human-stream-005.json`
- `tests/corpus/fitness/expected/parser/human/human-casual-001.json`
- `tests/corpus/fitness/expected/parser/human/human-casual-002.json`
- `tests/corpus/fitness/expected/parser/human/human-casual-003.json`
- `tests/corpus/fitness/expected/parser/human/human-casual-004.json`
- `tests/corpus/fitness/expected/parser/human/human-casual-005.json`
- `tests/corpus/fitness/expected/parser/human/human-detailed-001.json`
- `tests/corpus/fitness/expected/parser/human/human-detailed-002.json`
- `tests/corpus/fitness/expected/parser/human/human-detailed-003.json`
- `tests/corpus/fitness/expected/parser/human/human-detailed-004.json`
- `tests/corpus/fitness/expected/parser/human/human-detailed-005.json`
- `tests/corpus/test_human_entries.py`
